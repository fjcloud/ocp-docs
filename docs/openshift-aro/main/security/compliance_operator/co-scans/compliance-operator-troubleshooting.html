

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Troubleshooting Compliance Operator scans - Compliance Operator | Security and compliance | Azure Red Hat OpenShift Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.okd.io/latest/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      
      <span>
        <div class="alert alert-info" role="primary" id="support-info">
          <strong>Starting on March 12, 2025, OpenShift docs will only be available at <a href="https://docs.redhat.com/en/" style="color: #0C5460 !important" class="link-primary">docs.redhat.com</a>. From that time on, docs.openshift.com links will automatically redirect to their locations on docs.redhat.com.
          </strong>
        </div>
      </span>
      

      

      

      

      

      

      

      
      

      

      


      

      


      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          <a href="../../../security/index.html">Azure Red Hat OpenShift Branch Build</a>
        
      </li>
      <li class="hidden-xs active">
        <a href="../../../security/index.html">Security and compliance</a>
      </li>
      <li class="hidden-xs active"><a href="../../../security/compliance_operator/co-overview.html">Compliance Operator</a></li>
      <li class="hidden-xs active"><a href="../../../security/compliance_operator/co-scans/compliance-operator-supported-profiles.html">Compliance Operator scan management</a></li>
      <li class="hidden-xs active">
        Troubleshooting Compliance Operator scans
      </li>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-down"></span>Security and compliance</a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../../../security/index.html">Security and compliance overview</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-1"><span id="sgSpan-0-1" class="fa fa-caret-right"></span>&nbsp;Container security</a>
              <ul id="topicSubGroup-0-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../../security/container_security/security-understanding.html">Understanding container security</a></li>
                  <li><a class="" href="../../../security/container_security/security-hosts-vms.html">Understanding host and VM security</a></li>
                  <li><a class="" href="../../../security/container_security/security-hardening.html">Hardening Red Hat Enterprise Linux CoreOS</a></li>
                  <li><a class="" href="../../../security/container_security/security-container-signature.html">Container image signatures</a></li>
                  <li><a class="" href="../../../security/container_security/security-compliance.html">Understanding compliance</a></li>
                  <li><a class="" href="../../../security/container_security/security-container-content.html">Securing container content</a></li>
                  <li><a class="" href="../../../security/container_security/security-registries.html">Using container registries securely</a></li>
                  <li><a class="" href="../../../security/container_security/security-build.html">Securing the build process</a></li>
                  <li><a class="" href="../../../security/container_security/security-deploy.html">Deploying containers</a></li>
                  <li><a class="" href="../../../security/container_security/security-platform.html">Securing the container platform</a></li>
                  <li><a class="" href="../../../security/container_security/security-network.html">Securing networks</a></li>
                  <li><a class="" href="../../../security/container_security/security-storage.html">Securing attached storage</a></li>
                  <li><a class="" href="../../../security/container_security/security-monitoring.html">Monitoring cluster events and logs</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2"><span id="sgSpan-0-2" class="fa fa-caret-down"></span>&nbsp;Compliance Operator</a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse in">

                  <li><a class="" href="../../../security/compliance_operator/co-overview.html">Compliance Operator overview</a></li>
                  <li><a class="" href="../../../security/compliance_operator/compliance-operator-release-notes.html">Compliance Operator release notes</a></li>
                  <li><a class="" href="../../../security/compliance_operator/co-support.html">Compliance Operator support</a></li>
                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-3"><span id="ssgSpan-0-2-3" class="fa fa-caret-right"></span>&nbsp;Compliance Operator concepts</a>
                  <ul id="topicSubSubGroup-0-2-3" class="nav-tertiary list-unstyled collapse">

                    <li><a class="" href="../../../security/compliance_operator/co-concepts/compliance-operator-understanding.html" style="padding-left: 70px;">Understanding the Compliance Operator</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-concepts/compliance-operator-crd.html" style="padding-left: 70px;">Understanding the Custom Resource Definitions</a></li>                  </ul>
                  </li>

                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-4"><span id="ssgSpan-0-2-4" class="fa fa-caret-right"></span>&nbsp;Compliance Operator management</a>
                  <ul id="topicSubSubGroup-0-2-4" class="nav-tertiary list-unstyled collapse">

                    <li><a class="" href="../../../security/compliance_operator/co-management/compliance-operator-installation.html" style="padding-left: 70px;">Installing the Compliance Operator</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-management/compliance-operator-updating.html" style="padding-left: 70px;">Updating the Compliance Operator</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-management/compliance-operator-manage.html" style="padding-left: 70px;">Managing the Compliance Operator</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-management/compliance-operator-uninstallation.html" style="padding-left: 70px;">Uninstalling the Compliance Operator</a></li>                  </ul>
                  </li>

                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-5"><span id="ssgSpan-0-2-5" class="fa fa-caret-down"></span>&nbsp;Compliance Operator scan management</a>
                  <ul id="topicSubSubGroup-0-2-5" class="nav-tertiary list-unstyled collapse in">

                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-operator-supported-profiles.html" style="padding-left: 70px;">Supported compliance profiles</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-scans.html" style="padding-left: 70px;">Compliance Operator scans</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-operator-tailor.html" style="padding-left: 70px;">Tailoring the Compliance Operator</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-operator-raw-results.html" style="padding-left: 70px;">Retrieving Compliance Operator raw results</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-operator-remediation.html" style="padding-left: 70px;">Managing Compliance Operator remediation</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/compliance-operator-advanced.html" style="padding-left: 70px;">Performing advanced Compliance Operator tasks</a></li>
                    <li><a class=" active" href="../../../security/compliance_operator/co-scans/compliance-operator-troubleshooting.html" style="padding-left: 70px;">Troubleshooting Compliance Operator scans</a></li>
                    <li><a class="" href="../../../security/compliance_operator/co-scans/oc-compliance-plug-in-using.html" style="padding-left: 70px;">Using the oc-compliance plugin</a></li>                  </ul>
                  </li>
              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-3"><span id="sgSpan-0-3" class="fa fa-caret-right"></span>&nbsp;File Integrity Operator</a>
              <ul id="topicSubGroup-0-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../../security/file_integrity_operator/fio-overview.html">File Integrity Operator Overview</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-release-notes.html">File Integrity Operator release notes</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/fio-support.html">File Integrity Operator support</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-installation.html">Installing the File Integrity Operator</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-updating.html">Updating the File Integrity Operator</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-understanding.html">Understanding the File Integrity Operator</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-configuring.html">Configuring the File Integrity Operator</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-advanced-usage.html">Performing advanced File Integrity Operator tasks</a></li>
                  <li><a class="" href="../../../security/file_integrity_operator/file-integrity-operator-troubleshooting.html">Troubleshooting the File Integrity Operator</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-4"><span id="sgSpan-0-4" class="fa fa-caret-right"></span>&nbsp;Security Profiles Operator</a>
              <ul id="topicSubGroup-0-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../../security/security_profiles_operator/spo-overview.html">Security Profiles Operator overview</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-release-notes.html">Security Profiles Operator release notes</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-support.html">Security Profiles Operator support</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-understanding.html">Understanding the Security Profiles Operator</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-enabling.html">Enabling the Security Profiles Operator</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-seccomp.html">Managing seccomp profiles</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-selinux.html">Managing SELinux profiles</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-advanced.html">Advanced Security Profiles Operator tasks</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-troubleshooting.html">Troubleshooting the Security Profiles Operator</a></li>
                  <li><a class="" href="../../../security/security_profiles_operator/spo-uninstalling.html">Uninstalling the Security Profiles Operator</a></li>              </ul>
            </li>
            <li><a class="" href="../../../security/audit-log-view.html">Viewing audit logs</a></li>
            <li><a class="" href="../../../security/audit-log-policy-config.html">Configuring the audit log policy</a></li>
            <li><a class="" href="../../../security/tls-security-profiles.html">Configuring TLS security profiles</a></li>
            <li><a class="" href="../../../security/seccomp-profiles.html">Configuring seccomp profiles</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-9"><span id="sgSpan-0-9" class="fa fa-caret-right"></span>&nbsp;Network-Bound Disk Encryption (NBDE)</a>
              <ul id="topicSubGroup-0-9" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../../security/network_bound_disk_encryption/nbde-about-disk-encryption-technology.html">About disk encryption technology</a></li>
                  <li><a class="" href="../../../security/network_bound_disk_encryption/nbde-tang-server-installation-considerations.html">Tang server installation considerations</a></li>
                  <li><a class="" href="../../../security/network_bound_disk_encryption/nbde-managing-encryption-keys.html">Tang server encryption key management</a></li>              </ul>
            </li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            Troubleshooting Compliance Operator scans
          </h1>
        </div>
        
        
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#compliance-anatomy_compliance-troubleshooting">Anatomy of a scan</a>
<ul class="sectlevel2">
<li><a href="#compliance-anatomy-compliance-sources_compliance-troubleshooting">Compliance sources</a></li>
<li><a href="#compliance-anatomy-scan-setting-scan-binding-lifecycle_compliance-troubleshooting">The ScanSetting and ScanSettingBinding objects lifecycle and debugging</a></li>
<li><a href="#compliance-suite-lifecycle-debugging_compliance-troubleshooting">ComplianceSuite custom resource lifecycle and debugging</a></li>
<li><a href="#compliance-scan-lifecycle-debugging_compliance-troubleshooting">ComplianceScan custom resource lifecycle and debugging</a></li>
<li><a href="#compliance-remediation-lifecycle-debugging_compliance-troubleshooting">ComplianceRemediation controller lifecycle and debugging</a></li>
<li><a href="#compliance-operator-useful-labels_compliance-troubleshooting">Useful labels</a></li>
</ul>
</li>
<li><a href="#compliance-increasing-operator-limits_compliance-troubleshooting">Increasing Compliance Operator resource limits</a></li>
<li><a href="#operator-resource-constraints_compliance-troubleshooting">Configuring Operator resource constraints</a></li>
<li><a href="#co-scansetting-resources_compliance-troubleshooting">Configuring ScanSetting resources</a></li>
<li><a href="#compliance-timeout_compliance-troubleshooting">Configuring ScanSetting timeout</a></li>
<li><a href="#support_compliance-troubleshooting">Getting support</a></li>
</ul>
</div>
<div class="paragraph">
<p>This section describes how to troubleshoot the Compliance Operator. The information can be useful either to diagnose a problem or provide information in a bug report. Some general tips:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Compliance Operator emits Kubernetes events when something important happens. You can either view all events in the cluster using the command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp"> $</span><span class="w"> </span>oc get events <span class="nt">-n</span> openshift-compliance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or view events for an object like a scan using the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc describe <span class="nt">-n</span> openshift-compliance compliancescan/cis-compliance</code></pre>
</div>
</div>
</li>
<li>
<p>The Compliance Operator consists of several controllers, approximately one per API object. It could be useful to filter only those controllers that correspond to the API object having issues. If a <code>ComplianceRemediation</code> cannot be applied, view the messages from the <code>remediationctrl</code> controller. You can filter the messages from a single controller by parsing with <code>jq</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-compliance logs compliance-operator-775d7bddbd-gj58f <span class="se">\</span>
    | jq <span class="nt">-c</span> <span class="s1">'select(.logger == "profilebundlectrl")'</span></code></pre>
</div>
</div>
</li>
<li>
<p>The timestamps are logged as seconds since UNIX epoch in UTC. To convert them to a human-readable date, use <code>date -d @timestamp --utc</code>, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">date</span> <span class="nt">-d</span> @1596184628.955853 <span class="nt">--utc</span></code></pre>
</div>
</div>
</li>
<li>
<p>Many custom resources, most importantly <code>ComplianceSuite</code> and <code>ScanSetting</code>, allow the <code>debug</code> option to be set. Enabling this option increases verbosity of the OpenSCAP scanner pods, as well as some other helper pods.</p>
</li>
<li>
<p>If a single rule is passing or failing unexpectedly, it could be helpful to run a single scan or a suite with only that rule to find the rule ID from the corresponding <code>ComplianceCheckResult</code> object and use it as the <code>rule</code> attribute value in a <code>Scan</code> CR. Then, together with the <code>debug</code> option enabled, the <code>scanner</code> container logs in the scanner pod would show the raw OpenSCAP logs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compliance-anatomy_compliance-troubleshooting"><a class="anchor" href="#compliance-anatomy_compliance-troubleshooting"></a>Anatomy of a scan</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections outline the components and stages of Compliance Operator scans.</p>
</div>
<div class="sect2">
<h3 id="compliance-anatomy-compliance-sources_compliance-troubleshooting"><a class="anchor" href="#compliance-anatomy-compliance-sources_compliance-troubleshooting"></a>Compliance sources</h3>
<div class="paragraph">
<p>The compliance content is stored in <code>Profile</code> objects that are generated from a <code>ProfileBundle</code> object. The Compliance Operator creates a <code>ProfileBundle</code> object for the cluster and another for the cluster nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get <span class="nt">-n</span> openshift-compliance profilebundle.compliance</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get <span class="nt">-n</span> openshift-compliance profile.compliance</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ProfileBundle</code> objects are processed by deployments labeled with the <code>Bundle</code> name. To troubleshoot an issue with the <code>Bundle</code>, you can find the deployment and view logs of the pods in a deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc logs <span class="nt">-n</span> openshift-compliance <span class="nt">-lprofile-bundle</span><span class="o">=</span>ocp4 <span class="nt">-c</span> profileparser</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get <span class="nt">-n</span> openshift-compliance deployments,pods <span class="nt">-lprofile-bundle</span><span class="o">=</span>ocp4</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc logs <span class="nt">-n</span> openshift-compliance pods/&lt;pod-name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc describe <span class="nt">-n</span> openshift-compliance pod/&lt;pod-name&gt; <span class="nt">-c</span> profileparser</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compliance-anatomy-scan-setting-scan-binding-lifecycle_compliance-troubleshooting"><a class="anchor" href="#compliance-anatomy-scan-setting-scan-binding-lifecycle_compliance-troubleshooting"></a>The ScanSetting and ScanSettingBinding objects lifecycle and debugging</h3>
<div class="paragraph">
<p>With valid compliance content sources, the high-level <code>ScanSetting</code> and <code>ScanSettingBinding</code> objects can be used to generate <code>ComplianceSuite</code> and <code>ComplianceScan</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSetting</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-companys-constraints</span>
<span class="na">debug</span><span class="pi">:</span> <span class="no">true</span>
<span class="c1"># For each role, a separate scan will be created pointing</span>
<span class="c1"># to a node-role specified in roles</span>
<span class="na">roles</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">worker</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSettingBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-companys-compliance-requirements</span>
<span class="na">profiles</span><span class="pi">:</span>
  <span class="c1"># Node checks</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">rhcos4-e8</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Profile</span>
    <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
  <span class="c1"># Cluster checks</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ocp4-e8</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Profile</span>
    <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">settingsRef</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-companys-constraints</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSetting</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>ScanSetting</code> and <code>ScanSettingBinding</code> objects are handled by the same controller tagged with <code>logger=scansettingbindingctrl</code>.  These objects have no status. Any issues are communicated in form of events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">Events:
  Type     Reason        Age    From                    Message
  ----     ------        ----   ----                    -------
  Normal   SuiteCreated  9m52s  scansettingbindingctrl  ComplianceSuite openshift-compliance/my-companys-compliance-requirements created</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now a <code>ComplianceSuite</code> object is created. The flow continues to reconcile the newly created <code>ComplianceSuite</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="compliance-suite-lifecycle-debugging_compliance-troubleshooting"><a class="anchor" href="#compliance-suite-lifecycle-debugging_compliance-troubleshooting"></a>ComplianceSuite custom resource lifecycle and debugging</h3>
<div class="paragraph">
<p>The <code>ComplianceSuite</code> CR is a wrapper around <code>ComplianceScan</code> CRs. The <code>ComplianceSuite</code> CR is handled by controller tagged with <code>logger=suitectrl</code>.
This controller handles creating scans from a suite, reconciling and aggregating individual Scan statuses into a single Suite status. If a suite is set to execute periodically, the <code>suitectrl</code> also handles creating a <code>CronJob</code> CR that re-runs the scans in the suite after the initial run is done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get cronjobs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                                           SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
</span><span class="gp">&lt;cron_name&gt;</span><span class="w">                                    </span>0 1 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   False     0        &lt;none&gt;          151m</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the most important issues, events are emitted. View them with <code>oc describe compliancesuites/&lt;name&gt;</code>. The <code>Suite</code> objects also have a <code>Status</code> subresource that is updated when any of <code>Scan</code> objects that belong to this suite update their <code>Status</code> subresource. After all expected scans are created, control is passed to the scan controller.</p>
</div>
</div>
<div class="sect2">
<h3 id="compliance-scan-lifecycle-debugging_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-lifecycle-debugging_compliance-troubleshooting"></a>ComplianceScan custom resource lifecycle and debugging</h3>
<div class="paragraph">
<p>The <code>ComplianceScan</code> CRs are handled by the <code>scanctrl</code> controller. This is also where the actual scans happen and the scan results are created. Each scan goes through several phases:</p>
</div>
<div class="sect3">
<h4 id="compliance-scan-pending-phase_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-pending-phase_compliance-troubleshooting"></a>Pending phase</h4>
<div class="paragraph">
<p>The scan is validated for correctness in this phase. If some parameters like storage size are invalid, the scan transitions to DONE with ERROR result, otherwise proceeds to the Launching phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="compliance-scan-launching-phase_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-launching-phase_compliance-troubleshooting"></a>Launching phase</h4>
<div class="paragraph">
<p>In this phase, several config maps that contain either environment for the scanner pods or directly the script that the scanner pods will be evaluating. List the config maps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-compliance get cm <span class="se">\</span>
<span class="nt">-l</span> compliance.openshift.io/scan-name<span class="o">=</span>rhcos4-e8-worker,complianceoperator.openshift.io/scan-script<span class="o">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These config maps will be used by the scanner pods. If you ever needed to modify the scanner behavior, change the scanner debug level or print the raw results, modifying the config maps is the way to go. Afterwards, a persistent volume claim is created per scan to store the raw ARF results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get pvc <span class="nt">-n</span> openshift-compliance <span class="nt">-lcompliance</span>.openshift.io/scan-name<span class="o">=</span>rhcos4-e8-worker</code></pre>
</div>
</div>
<div class="paragraph">
<p>The PVCs are mounted by a per-scan <code>ResultServer</code> deployment. A <code>ResultServer</code> is a simple HTTP server where the individual scanner pods upload the full ARF results to. Each server can run on a different node. The full ARF results might be very large and you cannot presume that it would be possible to create a volume that could be mounted from multiple nodes at the same time. After the scan is finished, the <code>ResultServer</code> deployment is scaled down. The PVC with the raw results can be mounted from another custom pod and the results can be fetched or inspected. The traffic between the scanner pods and the <code>ResultServer</code> is protected by mutual TLS protocols.</p>
</div>
<div class="paragraph">
<p>Finally, the scanner pods are launched in this phase; one scanner pod for a <code>Platform</code> scan instance and one scanner pod per matching node for a <code>node</code> scan instance. The per-node pods are labeled with the node name. Each pod is always labeled with the <code>ComplianceScan</code> name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get pods <span class="nt">-lcompliance</span>.openshift.io/scan-name<span class="o">=</span>rhcos4-e8-worker,workload<span class="o">=</span>scanner <span class="nt">--show-labels</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                                                              READY   STATUS      RESTARTS   AGE   LABELS
rhcos4-e8-worker-ip-10-0-169-90.eu-north-1.compute.internal-pod   0/2     Completed   0          39m   compliance.openshift.io/scan-name=rhcos4-e8-worker,targetNode=ip-10-0-169-90.eu-north-1.compute.internal,workload=scanner</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The scan then proceeds to the Running phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="compliance-scan-running-phase_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-running-phase_compliance-troubleshooting"></a>Running phase</h4>
<div class="paragraph">
<p>The running phase waits until the scanner pods finish. The following terms and processes are in use in the running phase:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>init container</strong>: There is one init container called <code>content-container</code>. It runs the <strong>contentImage</strong> container and executes a single command that copies the <strong>contentFile</strong> to the <code>/content</code> directory shared with the other containers in this pod.</p>
</li>
<li>
<p><strong>scanner</strong>: This container runs the scan. For node scans, the container mounts the node filesystem as <code>/host</code> and mounts the content delivered by the init container. The container also mounts the <code>entrypoint</code> <code>ConfigMap</code> created in the Launching phase and executes it. The default script in the entrypoint <code>ConfigMap</code> executes OpenSCAP and stores the result files in the <code>/results</code> directory shared between the pod&#8217;s containers. Logs from this pod can be viewed to determine what the OpenSCAP scanner checked. More verbose output can be viewed with the <code>debug</code> flag.</p>
</li>
<li>
<p><strong>logcollector</strong>: The logcollector container waits until the scanner container finishes. Then, it uploads the full ARF results to the <code>ResultServer</code> and separately uploads the XCCDF results along with scan result and OpenSCAP result code as a <code>ConfigMap.</code> These result config maps are labeled with the scan name (<code>compliance.openshift.io/scan-name=rhcos4-e8-worker</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc describe cm/rhcos4-e8-worker-ip-10-0-169-90.eu-north-1.compute.internal-pod</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">      Name:         rhcos4-e8-worker-ip-10-0-169-90.eu-north-1.compute.internal-pod
      Namespace:    openshift-compliance
      Labels:       compliance.openshift.io/scan-name-scan=rhcos4-e8-worker
                    complianceoperator.openshift.io/scan-result=
      Annotations:  compliance-remediations/processed:
                    compliance.openshift.io/scan-error-msg:
                    compliance.openshift.io/scan-result: NON-COMPLIANT
                    OpenSCAP-scan-result/node: ip-10-0-169-90.eu-north-1.compute.internal

      Data
      ====
      exit-code:
      ----
      2
      results:
      ----
</span><span class="gp">      &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="w">
</span><span class="c">      ...</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scanner pods for <code>Platform</code> scans are similar, except:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is one extra init container called <code>api-resource-collector</code> that reads the OpenSCAP content provided by the content-container init, container, figures out which API resources the content needs to examine and stores those API resources to a shared directory where the <code>scanner</code> container would read them from.</p>
</li>
<li>
<p>The <code>scanner</code> container does not need to mount the host file system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the scanner pods are done, the scans move on to the Aggregating phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="compliance-scan-aggregating-phase_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-aggregating-phase_compliance-troubleshooting"></a>Aggregating phase</h4>
<div class="paragraph">
<p>In the aggregating phase, the scan controller spawns yet another pod called the aggregator pod. Its purpose it to take the result <code>ConfigMap</code> objects, read the results and for each check result create the corresponding Kubernetes object. If the check failure can be automatically remediated, a <code>ComplianceRemediation</code> object is created. To provide human-readable metadata for the checks and remediations, the aggregator pod also mounts the OpenSCAP content using an init container.</p>
</div>
<div class="paragraph">
<p>When a config map is processed by an aggregator pod, it is labeled the <code>compliance-remediations/processed</code> label. The result of this phase are <code>ComplianceCheckResult</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get compliancecheckresults <span class="nt">-lcompliance</span>.openshift.io/scan-name<span class="o">=</span>rhcos4-e8-worker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                                                       STATUS   SEVERITY
rhcos4-e8-worker-accounts-no-uid-except-zero               PASS     high
rhcos4-e8-worker-audit-rules-dac-modification-chmod        FAIL     medium</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>ComplianceRemediation</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get complianceremediations <span class="nt">-lcompliance</span>.openshift.io/scan-name<span class="o">=</span>rhcos4-e8-worker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                                                       STATE
rhcos4-e8-worker-audit-rules-dac-modification-chmod        NotApplied
rhcos4-e8-worker-audit-rules-dac-modification-chown        NotApplied
rhcos4-e8-worker-audit-rules-execution-chcon               NotApplied
rhcos4-e8-worker-audit-rules-execution-restorecon          NotApplied
rhcos4-e8-worker-audit-rules-execution-semanage            NotApplied
rhcos4-e8-worker-audit-rules-execution-setfiles            NotApplied</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After these CRs are created, the aggregator pod exits and the scan moves on to the Done phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="compliance-scan-done-phase_compliance-troubleshooting"><a class="anchor" href="#compliance-scan-done-phase_compliance-troubleshooting"></a>Done phase</h4>
<div class="paragraph">
<p>In the final scan phase, the scan resources are cleaned up if needed and the <code>ResultServer</code> deployment is either scaled down (if the scan was one-time) or deleted if the scan is continuous; the next scan instance would then recreate the deployment again.</p>
</div>
<div class="paragraph">
<p>It is also possible to trigger a re-run of a scan in the Done phase by annotating it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-compliance <span class="se">\</span>
annotate compliancescans/rhcos4-e8-worker compliance.openshift.io/rescan<span class="o">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the scan reaches the Done phase, nothing else happens on its own unless the remediations are set to be applied automatically with <code>autoApplyRemediations: true</code>. The Azure Red Hat OpenShift administrator would now review the remediations and apply them as needed. If the remediations are set to be applied automatically, the <code>ComplianceSuite</code> controller takes over in the Done phase, pauses the machine config pool to which the scan maps to and applies all the remediations in one go. If a remediation is applied, the <code>ComplianceRemediation</code> controller takes over.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compliance-remediation-lifecycle-debugging_compliance-troubleshooting"><a class="anchor" href="#compliance-remediation-lifecycle-debugging_compliance-troubleshooting"></a>ComplianceRemediation controller lifecycle and debugging</h3>
<div class="paragraph">
<p>The example scan has reported some findings. One of the remediations can be enabled by toggling its <code>apply</code> attribute to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc patch complianceremediations/rhcos4-e8-worker-audit-rules-dac-modification-chmod <span class="nt">--patch</span> <span class="s1">'{"spec":{"apply":true}}'</span> <span class="nt">--type</span><span class="o">=</span>merge</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ComplianceRemediation</code> controller (<code>logger=remediationctrl</code>) reconciles the modified object. The result of the reconciliation is change of status of the remediation object that is reconciled, but also a change of the rendered per-suite <code>MachineConfig</code> object that contains all the applied remediations.</p>
</div>
<div class="paragraph">
<p>The <code>MachineConfig</code> object always begins with <code>75-</code> and is named after the scan and the suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get mc | <span class="nb">grep </span>75-</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">75-rhcos4-e8-worker-my-companys-compliance-requirements                                                3.2.0             2m46s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The remediations the <code>mc</code> currently consists of are listed in the machine config&#8217;s annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc describe mc/75-rhcos4-e8-worker-my-companys-compliance-requirements</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">Name:         75-rhcos4-e8-worker-my-companys-compliance-requirements
Labels:       machineconfiguration.openshift.io/role=worker
Annotations:  remediation/rhcos4-e8-worker-audit-rules-dac-modification-chmod:</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ComplianceRemediation</code> controller&#8217;s algorithm works like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All currently applied remediations are read into an initial remediation set.</p>
</li>
<li>
<p>If the reconciled remediation is supposed to be applied, it is added to the set.</p>
</li>
<li>
<p>A <code>MachineConfig</code> object is rendered from the set and annotated with names  of remediations in the set. If the set is empty (the last remediation was unapplied), the rendered <code>MachineConfig</code> object is removed.</p>
</li>
<li>
<p>If and only if the rendered machine config is different from the one already applied in the cluster, the applied MC is updated (or created, or deleted).</p>
</li>
<li>
<p>Creating or modifying a <code>MachineConfig</code> object triggers a reboot of nodes that match the <code>machineconfiguration.openshift.io/role</code> label - see the Machine Config Operator documentation for more details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remediation loop ends once the rendered machine config is updated, if needed, and the reconciled remediation object status is updated. In our case, applying the remediation would trigger a reboot. After the reboot, annotate the scan to re-run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-compliance <span class="se">\</span>
annotate compliancescans/rhcos4-e8-worker compliance.openshift.io/rescan<span class="o">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The scan will run and finish. Check for the remediation to pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-compliance <span class="se">\</span>
get compliancecheckresults/rhcos4-e8-worker-audit-rules-dac-modification-chmod</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                                                  STATUS   SEVERITY
rhcos4-e8-worker-audit-rules-dac-modification-chmod   PASS     medium</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compliance-operator-useful-labels_compliance-troubleshooting"><a class="anchor" href="#compliance-operator-useful-labels_compliance-troubleshooting"></a>Useful labels</h3>
<div class="paragraph">
<p>Each pod that is spawned by the Compliance Operator is labeled specifically with the scan it belongs to and the work it does. The scan identifier is labeled with the <code>compliance.openshift.io/scan-name</code> label. The workload identifier is labeled with the <code>workload</code> label.</p>
</div>
<div class="paragraph">
<p>The Compliance Operator schedules the following workloads:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scanner</strong>: Performs the compliance scan.</p>
</li>
<li>
<p><strong>resultserver</strong>: Stores the raw results for the compliance scan.</p>
</li>
<li>
<p><strong>aggregator</strong>: Aggregates the results, detects inconsistencies and outputs result objects (checkresults and remediations).</p>
</li>
<li>
<p><strong>suitererunner</strong>: Will tag a suite to be re-run (when a schedule is set).</p>
</li>
<li>
<p><strong>profileparser</strong>: Parses a datastream and creates the appropriate profiles, rules and variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When debugging and logs are required for a certain workload, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc logs <span class="nt">-l</span> <span class="nv">workload</span><span class="o">=</span>&lt;workload_name&gt; <span class="nt">-c</span> &lt;container_name&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compliance-increasing-operator-limits_compliance-troubleshooting"><a class="anchor" href="#compliance-increasing-operator-limits_compliance-troubleshooting"></a>Increasing Compliance Operator resource limits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, the Compliance Operator might require more memory than the default limits allow. The best way to mitigate this issue is to set custom resource limits.</p>
</div>
<div class="paragraph">
<p>To increase the default memory and CPU limits of scanner pods, see <em>`ScanSetting` Custom resource</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To increase the Operator&#8217;s memory limits to 500 Mi, create the following patch file named <code>co-memlimit-patch.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">spec</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">500Mi</span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply the patch file:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc patch sub compliance-operator <span class="nt">-nopenshift-compliance</span> <span class="nt">--patch-file</span> co-memlimit-patch.yaml <span class="nt">--type</span><span class="o">=</span>merge</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operator-resource-constraints_compliance-troubleshooting"><a class="anchor" href="#operator-resource-constraints_compliance-troubleshooting"></a>Configuring Operator resource constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>resources</code> field defines Resource Constraints for all the containers in the Pod created by the Operator Lifecycle Manager (OLM).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Resource Constraints applied in this process overwrites the existing resource constraints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Inject a request of 0.25 cpu and 64 Mi of memory, and a limit of 0.5 cpu and 128 Mi of memory in each container by editing the <code>Subscription</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">Subscription</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-operator</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">package</span><span class="pi">:</span> <span class="s">package-name</span>
  <span class="na">channel</span><span class="pi">:</span> <span class="s">stable</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">64Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="co-scansetting-resources_compliance-troubleshooting"><a class="anchor" href="#co-scansetting-resources_compliance-troubleshooting"></a>Configuring ScanSetting resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using the Compliance Operator in a cluster that contains more than 500 MachineConfigs, the <code>ocp4-pci-dss-api-checks-pod</code> pod may pause in the <code>init</code> phase when performing a <code>Platform</code> scan.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Resource constraints applied in this process overwrites the existing resource constraints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Confirm the <code>ocp4-pci-dss-api-checks-pod</code> pod is stuck in the <code>Init:OOMKilled</code> status:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get pod ocp4-pci-dss-api-checks-pod <span class="nt">-w</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                          READY   STATUS     RESTARTS        AGE
ocp4-pci-dss-api-checks-pod   0/2     Init:1/2   8 (5m56s ago)   25m
ocp4-pci-dss-api-checks-pod   0/2     Init:OOMKilled   8 (6m19s ago)   26m</span></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the  <code>scanLimits</code> attribute in the <code>ScanSetting</code> CR to increase the available memory for the <code>ocp4-pci-dss-api-checks-pod</code> pod:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">timeout</span><span class="pi">:</span> <span class="s">30m</span>
<span class="na">strictNodeScan</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSetting</span>
<span class="na">showNotApplicable</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">rawResultStorage</span><span class="pi">:</span>
  <span class="na">nodeSelector</span><span class="pi">:</span>
    <span class="s">node-role.kubernetes.io/master</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
  <span class="na">pvAccessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">rotation</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">size</span><span class="pi">:</span> <span class="s">1Gi</span>
  <span class="na">tolerations</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
      <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
    <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoExecute</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s">node.kubernetes.io/not-ready</span>
      <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
      <span class="na">tolerationSeconds</span><span class="pi">:</span> <span class="m">300</span>
    <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoExecute</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s">node.kubernetes.io/unreachable</span>
      <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
      <span class="na">tolerationSeconds</span><span class="pi">:</span> <span class="m">300</span>
    <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s">node.kubernetes.io/memory-pressure</span>
      <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
<span class="na">schedule</span><span class="pi">:</span> <span class="s">0 1 * * *</span>
<span class="na">roles</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">master</span>
  <span class="pi">-</span> <span class="s">worker</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">maxRetryOnTimeout</span><span class="pi">:</span> <span class="m">3</span>
<span class="na">scanTolerations</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
<span class="na">scanLimits</span><span class="pi">:</span>
  <span class="na">memory</span><span class="pi">:</span> <span class="s">1024Mi</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default setting is <code>500Mi</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>ScanSetting</code> CR to your cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> scansetting.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compliance-timeout_compliance-troubleshooting"><a class="anchor" href="#compliance-timeout_compliance-troubleshooting"></a>Configuring ScanSetting timeout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ScanSetting</code> object has a timeout option that can be specified in the <code>ComplianceScanSetting</code> object as a duration string, such as <code>1h30m</code>. If the scan does not finish within the specified timeout, the scan reattempts until the <code>maxRetryOnTimeout</code> limit is reached.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To set a <code>timeout</code> and <code>maxRetryOnTimeout</code> in ScanSetting, modify an existing <code>ScanSetting</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSetting</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">rawResultStorage</span><span class="pi">:</span>
  <span class="na">rotation</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">size</span><span class="pi">:</span> <span class="s">1Gi</span>
<span class="na">roles</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">worker</span>
<span class="pi">-</span> <span class="s">master</span>
<span class="na">scanTolerations</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
  <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
<span class="na">schedule</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>
<span class="na">timeout</span><span class="pi">:</span> <span class="s1">'</span><span class="s">10m0s'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="na">maxRetryOnTimeout</span><span class="pi">:</span> <span class="s">3</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>timeout</code> variable is defined as a duration string, such as <code>1h30m</code>. The default value is <code>30m</code>. To disable the timeout, set the value to <code>0s</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>maxRetryOnTimeout</code> variable defines how many times a retry is attempted. The default value is <code>3</code>.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support_compliance-troubleshooting"><a class="anchor" href="#support_compliance-troubleshooting"></a>Getting support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you experience difficulty with a procedure described in this documentation, or with Azure Red Hat OpenShift in general, visit the <a href="http://access.redhat.com">Red Hat Customer Portal</a>.</p>
</div>
<div class="paragraph">
<p>From the Customer Portal, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Search or browse through the Red Hat Knowledgebase of articles and solutions relating to Red Hat products.</p>
</li>
<li>
<p>Submit a support case to Red Hat Support.</p>
</li>
<li>
<p>Access other product documentation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To identify issues with your cluster, you can use Insights in <a href="https://console.redhat.com/openshift">OpenShift Cluster Manager</a>. Insights provides details about issues and, if available, information on how to solve a problem.</p>
</div>
<div class="paragraph">
<p>If you have a suggestion for improving this documentation or have found an
error, submit a <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&amp;summary=Documentation_issue&amp;issuetype=1&amp;components=12367614&amp;priority=10200&amp;versions=12385624">Jira issue</a> for the most relevant documentation component. Please provide specific details, such as the section name and Azure Red Hat OpenShift version.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'openshift-aro';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-telco': ['docs_telco', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version],
    'openshift-serverless' : ['docs_serverless', version],
    'openshift-pipelines' : ['docs_pipelines', version],
    'openshift-builds' : ['docs_builds', version],
    'openshift-gitops' : ['docs_gitops', version],
    'openshift-lightspeed' : ['docs_lightspeed', version],
    'openshift-service-mesh' : ['docs_service_mesh', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.net/content/img/Logo-Red_Hat-OpenShift-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright © 2025 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

  <!-- hide footer after 3 seconds -->
  <script type="text/javascript">
    const hideFooter = () => {
      document.querySelector('footer#rh, footer.footer-origin-docs').style.display = "none";
    };

    window.addEventListener('load', function() {
      setTimeout(hideFooter, 3000);
    });
  </script>
</body>
</html>