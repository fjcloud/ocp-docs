

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Managing SELinux profiles - Security Profiles Operator | Security and compliance | Azure Red Hat OpenShift Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.okd.io/latest/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.okd.io/latest/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      
      <span>
        <div class="alert alert-info" role="primary" id="support-info">
          <strong>Starting on March 12, 2025, OpenShift docs will only be available at <a href="https://docs.redhat.com/en/" style="color: #0C5460 !important" class="link-primary">docs.redhat.com</a>. From that time on, docs.openshift.com links will automatically redirect to their locations on docs.redhat.com.
          </strong>
        </div>
      </span>
      

      

      

      

      

      

      

      
      

      

      


      

      


      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          <a href="../../security/index.html">Azure Red Hat OpenShift Branch Build</a>
        
      </li>
      <li class="hidden-xs active">
        <a href="../../security/index.html">Security and compliance</a>
      </li>
      <li class="hidden-xs active"><a href="../../security/security_profiles_operator/spo-overview.html">Security Profiles Operator</a></li>
      
      <li class="hidden-xs active">
        Managing SELinux profiles
      </li>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-down"></span>Security and compliance</a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../../security/index.html">Security and compliance overview</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-1"><span id="sgSpan-0-1" class="fa fa-caret-right"></span>&nbsp;Container security</a>
              <ul id="topicSubGroup-0-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../security/container_security/security-understanding.html">Understanding container security</a></li>
                  <li><a class="" href="../../security/container_security/security-hosts-vms.html">Understanding host and VM security</a></li>
                  <li><a class="" href="../../security/container_security/security-hardening.html">Hardening Red Hat Enterprise Linux CoreOS</a></li>
                  <li><a class="" href="../../security/container_security/security-container-signature.html">Container image signatures</a></li>
                  <li><a class="" href="../../security/container_security/security-compliance.html">Understanding compliance</a></li>
                  <li><a class="" href="../../security/container_security/security-container-content.html">Securing container content</a></li>
                  <li><a class="" href="../../security/container_security/security-registries.html">Using container registries securely</a></li>
                  <li><a class="" href="../../security/container_security/security-build.html">Securing the build process</a></li>
                  <li><a class="" href="../../security/container_security/security-deploy.html">Deploying containers</a></li>
                  <li><a class="" href="../../security/container_security/security-platform.html">Securing the container platform</a></li>
                  <li><a class="" href="../../security/container_security/security-network.html">Securing networks</a></li>
                  <li><a class="" href="../../security/container_security/security-storage.html">Securing attached storage</a></li>
                  <li><a class="" href="../../security/container_security/security-monitoring.html">Monitoring cluster events and logs</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2"><span id="sgSpan-0-2" class="fa fa-caret-right"></span>&nbsp;Compliance Operator</a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../security/compliance_operator/co-overview.html">Compliance Operator overview</a></li>
                  <li><a class="" href="../../security/compliance_operator/compliance-operator-release-notes.html">Compliance Operator release notes</a></li>
                  <li><a class="" href="../../security/compliance_operator/co-support.html">Compliance Operator support</a></li>
                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-3"><span id="ssgSpan-0-2-3" class="fa fa-caret-right"></span>&nbsp;Compliance Operator concepts</a>
                  <ul id="topicSubSubGroup-0-2-3" class="nav-tertiary list-unstyled collapse">

                    <li><a class="" href="../../security/compliance_operator/co-concepts/compliance-operator-understanding.html" style="padding-left: 70px;">Understanding the Compliance Operator</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-concepts/compliance-operator-crd.html" style="padding-left: 70px;">Understanding the Custom Resource Definitions</a></li>                  </ul>
                  </li>

                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-4"><span id="ssgSpan-0-2-4" class="fa fa-caret-right"></span>&nbsp;Compliance Operator management</a>
                  <ul id="topicSubSubGroup-0-2-4" class="nav-tertiary list-unstyled collapse">

                    <li><a class="" href="../../security/compliance_operator/co-management/compliance-operator-installation.html" style="padding-left: 70px;">Installing the Compliance Operator</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-management/compliance-operator-updating.html" style="padding-left: 70px;">Updating the Compliance Operator</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-management/compliance-operator-manage.html" style="padding-left: 70px;">Managing the Compliance Operator</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-management/compliance-operator-uninstallation.html" style="padding-left: 70px;">Uninstalling the Compliance Operator</a></li>                  </ul>
                  </li>

                <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubSubGroup-0-2-5"><span id="ssgSpan-0-2-5" class="fa fa-caret-right"></span>&nbsp;Compliance Operator scan management</a>
                  <ul id="topicSubSubGroup-0-2-5" class="nav-tertiary list-unstyled collapse">

                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-supported-profiles.html" style="padding-left: 70px;">Supported compliance profiles</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-scans.html" style="padding-left: 70px;">Compliance Operator scans</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-tailor.html" style="padding-left: 70px;">Tailoring the Compliance Operator</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-raw-results.html" style="padding-left: 70px;">Retrieving Compliance Operator raw results</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-remediation.html" style="padding-left: 70px;">Managing Compliance Operator remediation</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-advanced.html" style="padding-left: 70px;">Performing advanced Compliance Operator tasks</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/compliance-operator-troubleshooting.html" style="padding-left: 70px;">Troubleshooting Compliance Operator scans</a></li>
                    <li><a class="" href="../../security/compliance_operator/co-scans/oc-compliance-plug-in-using.html" style="padding-left: 70px;">Using the oc-compliance plugin</a></li>                  </ul>
                  </li>
              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-3"><span id="sgSpan-0-3" class="fa fa-caret-right"></span>&nbsp;File Integrity Operator</a>
              <ul id="topicSubGroup-0-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../security/file_integrity_operator/fio-overview.html">File Integrity Operator Overview</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-release-notes.html">File Integrity Operator release notes</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/fio-support.html">File Integrity Operator support</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-installation.html">Installing the File Integrity Operator</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-updating.html">Updating the File Integrity Operator</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-understanding.html">Understanding the File Integrity Operator</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-configuring.html">Configuring the File Integrity Operator</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-advanced-usage.html">Performing advanced File Integrity Operator tasks</a></li>
                  <li><a class="" href="../../security/file_integrity_operator/file-integrity-operator-troubleshooting.html">Troubleshooting the File Integrity Operator</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-4"><span id="sgSpan-0-4" class="fa fa-caret-down"></span>&nbsp;Security Profiles Operator</a>
              <ul id="topicSubGroup-0-4" class="nav-tertiary list-unstyled collapse in">

                  <li><a class="" href="../../security/security_profiles_operator/spo-overview.html">Security Profiles Operator overview</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-release-notes.html">Security Profiles Operator release notes</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-support.html">Security Profiles Operator support</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-understanding.html">Understanding the Security Profiles Operator</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-enabling.html">Enabling the Security Profiles Operator</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-seccomp.html">Managing seccomp profiles</a></li>
                  <li><a class=" active" href="../../security/security_profiles_operator/spo-selinux.html">Managing SELinux profiles</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-advanced.html">Advanced Security Profiles Operator tasks</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-troubleshooting.html">Troubleshooting the Security Profiles Operator</a></li>
                  <li><a class="" href="../../security/security_profiles_operator/spo-uninstalling.html">Uninstalling the Security Profiles Operator</a></li>              </ul>
            </li>
            <li><a class="" href="../../security/audit-log-view.html">Viewing audit logs</a></li>
            <li><a class="" href="../../security/audit-log-policy-config.html">Configuring the audit log policy</a></li>
            <li><a class="" href="../../security/tls-security-profiles.html">Configuring TLS security profiles</a></li>
            <li><a class="" href="../../security/seccomp-profiles.html">Configuring seccomp profiles</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-9"><span id="sgSpan-0-9" class="fa fa-caret-right"></span>&nbsp;Network-Bound Disk Encryption (NBDE)</a>
              <ul id="topicSubGroup-0-9" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../security/network_bound_disk_encryption/nbde-about-disk-encryption-technology.html">About disk encryption technology</a></li>
                  <li><a class="" href="../../security/network_bound_disk_encryption/nbde-tang-server-installation-considerations.html">Tang server installation considerations</a></li>
                  <li><a class="" href="../../security/network_bound_disk_encryption/nbde-managing-encryption-keys.html">Tang server encryption key management</a></li>              </ul>
            </li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            Managing SELinux profiles
          </h1>
        </div>
        
        
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#spo-creating-profiles_spo-selinux">Creating SELinux profiles</a></li>
<li><a href="#spo-applying-profiles_spo-selinux">Applying SELinux profiles to a pod</a>
<ul class="sectlevel2">
<li><a href="#spo-selinux-permissive_spo-selinux">Applying SELinux log policies</a></li>
<li><a href="#spo-binding-workloads_spo-selinux">Binding workloads to profiles with ProfileBindings</a></li>
<li><a href="#spo-replicating-controllers_spo-selinux">Replicating controllers and SecurityContextConstraints</a></li>
</ul>
</li>
<li><a href="#spo-recording-profiles_spo-selinux">Recording profiles from workloads</a>
<ul class="sectlevel2">
<li><a href="#spo-container-profile-instances_spo-selinux">Merging per-container profile instances</a></li>
<li><a href="#spo-selinux-runasany_spo-selinux">About seLinuxContext: RunAsAny</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create and manage SELinux profiles and bind them to workloads.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Security Profiles Operator supports only Red Hat Enterprise Linux CoreOS (RHCOS) worker nodes. Red Hat Enterprise Linux (RHEL) nodes are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spo-creating-profiles_spo-selinux"><a class="anchor" href="#spo-creating-profiles_spo-selinux"></a>Creating SELinux profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <code>SelinuxProfile</code> object to create profiles.</p>
</div>
<div class="paragraph">
<p>The <code>SelinuxProfile</code> object has several features that allow for better security hardening and readability:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restricts the profiles to inherit from to the current namespace or a system-wide profile. Because there are typically many profiles installed on the system, but only a subset should be used by cluster workloads, the inheritable system profiles are listed in the <code>spod</code> instance in <code>spec.selinuxOptions.allowedSystemProfiles</code>.</p>
</li>
<li>
<p>Performs basic validation of the permissions, classes and labels.</p>
</li>
<li>
<p>Adds a new keyword <code>@self</code> that describes the process using the policy. This allows reusing a policy between workloads and namespaces easily, as the usage of the policy is based on the name and namespace.</p>
</li>
<li>
<p>Adds features for better security hardening and readability compared to writing a profile directly in the SELinux CIL language.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a project by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc new-project nginx-deploy</code></pre>
</div>
</div>
</li>
<li>
<p>Create a policy that can be used with a non-privileged workload by creating the following <code>SelinuxProfile</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security-profiles-operator.x-k8s.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SelinuxProfile</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-secure</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-deploy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">allow</span><span class="pi">:</span>
    <span class="s1">'</span><span class="s">@self'</span><span class="pi">:</span>
      <span class="na">tcp_socket</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">listen</span>
    <span class="na">http_cache_port_t</span><span class="pi">:</span>
      <span class="na">tcp_socket</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name_bind</span>
    <span class="na">node_t</span><span class="pi">:</span>
      <span class="na">tcp_socket</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">node_bind</span>
  <span class="na">inherit</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">System</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">container</span></code></pre>
</div>
</div>
</li>
<li>
<p>Wait for <code>selinuxd</code> to install the policy by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nb">wait</span> <span class="nt">--for</span><span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready <span class="nt">-n</span> nginx-deploy selinuxprofile nginx-secure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">selinuxprofile.security-profiles-operator.x-k8s.io/nginx-secure condition met</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The policies are placed into an <code>emptyDir</code> in the container owned by the Security Profiles Operator. The policies are saved in Common Intermediate Language (CIL) format in <code>/etc/selinux.d/&lt;name&gt;_&lt;namespace&gt;.cil</code>.</p>
</div>
</li>
<li>
<p>Access the pod by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-security-profiles rsh <span class="nt">-c</span> selinuxd ds/spod</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>View the file contents with <code>cat</code> by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">cat</span> /etc/selinux.d/nginx-secure_nginx-deploy.cil</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">(block nginx-secure_nginx-deploy
(blockinherit container)
(allow process nginx-secure_nginx-deploy.process ( tcp_socket ( listen )))
(allow process http_cache_port_t ( tcp_socket ( name_bind )))
(allow process node_t ( tcp_socket ( node_bind )))
)</span></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that a policy has been installed by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>semodule <span class="nt">-l</span> | <span class="nb">grep </span>nginx-secure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">nginx-secure_nginx-deploy</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spo-applying-profiles_spo-selinux"><a class="anchor" href="#spo-applying-profiles_spo-selinux"></a>Applying SELinux profiles to a pod</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a pod to apply one of the created profiles.</p>
</div>
<div class="paragraph">
<p>For SELinux profiles, the namespace must be labelled to allow <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">privileged</a> workloads.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>scc.podSecurityLabelSync=false</code> label to the <code>nginx-deploy</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label ns nginx-deploy security.openshift.io/scc.podSecurityLabelSync<span class="o">=</span><span class="nb">false</span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>privileged</code> label to the <code>nginx-deploy</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label ns nginx-deploy <span class="nt">--overwrite</span><span class="o">=</span><span class="nb">true </span>pod-security.kubernetes.io/enforce<span class="o">=</span>privileged</code></pre>
</div>
</div>
</li>
<li>
<p>Obtain the SELinux profile usage string by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get selinuxprofile.security-profiles-operator.x-k8s.io/nginx-secure <span class="nt">-n</span> nginx-deploy <span class="nt">-ojsonpath</span><span class="o">=</span><span class="s1">'{.status.usage}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">nginx-secure_nginx-deploy.process</span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply the output string in the workload manifest in the <code>.spec.containers[].securityContext.seLinuxOptions</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-secure</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-deploy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">securityContext</span><span class="pi">:</span>
    <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">seccompProfile</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">RuntimeDefault</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginxinc/nginx-unprivileged:1.21</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">capabilities</span><span class="pi">:</span>
          <span class="na">drop</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">ALL</span><span class="pi">]</span>
        <span class="na">seLinuxOptions</span><span class="pi">:</span>
          <span class="c1"># NOTE: This uses an appropriate SELinux type</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">nginx-secure_nginx-deploy.process</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SELinux <code>type</code> must exist before creating the workload.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="spo-selinux-permissive_spo-selinux"><a class="anchor" href="#spo-selinux-permissive_spo-selinux"></a>Applying SELinux log policies</h3>
<div class="paragraph">
<p>To log policy violations or AVC denials, set the <code>SElinuxProfile</code> profile to <code>permissive</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure defines logging policies. It does not set enforcement policies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add <code>permissive: true</code> to an <code>SElinuxProfile</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security-profiles-operator.x-k8s.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SelinuxProfile</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-secure</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-deploy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">permissive</span><span class="pi">:</span> <span class="no">true</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spo-binding-workloads_spo-selinux"><a class="anchor" href="#spo-binding-workloads_spo-selinux"></a>Binding workloads to profiles with ProfileBindings</h3>
<div class="paragraph">
<p>You can use the <code>ProfileBinding</code> resource to bind a security profile to the <code>SecurityContext</code> of a container.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To bind a pod that uses a <code>quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</code> image to the example <code>SelinuxProfile</code> profile, create a <code>ProfileBinding</code> object in the same namespace with the pod and the <code>SelinuxProfile</code> objects:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security-profiles-operator.x-k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ProfileBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">my-namespace</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-binding</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">profileRef</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">SelinuxProfile</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="na">name</span><span class="pi">:</span> <span class="s">profile</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>kind:</code> variable refers to the kind of the profile.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>name:</code> variable refers to the name of the profile.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can enable a default security profile by using a wildcard in the image attribute: <code>image: "*"</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>image: "*"</code> wildcard attribute binds all new pods with a default security profile in a given namespace.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Label the namespace with <code>enable-binding=true</code> by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label ns my-namespace spo.x-k8s.io/enable-binding<span class="o">=</span><span class="nb">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Define a pod named <code>test-pod.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">test-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">test-container</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create the pod:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create <span class="nt">-f</span> test-pod.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the pod already exists, you must re-create the pod for the binding to work properly.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Confirm the pod inherits the <code>ProfileBinding</code> by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get pod test-pod <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.containers[*].securityContext.seLinuxOptions.type}'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">profile_nginx-binding.process</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spo-replicating-controllers_spo-selinux"><a class="anchor" href="#spo-replicating-controllers_spo-selinux"></a>Replicating controllers and SecurityContextConstraints</h3>
<div class="paragraph">
<p>When you deploy SELinux policies for replicating controllers, such as deployments or daemon sets, note that the <code>Pod</code> objects spawned by the controllers are not running with the identity of the user who creates the workload. Unless a <code>ServiceAccount</code> is selected, the pods might revert to using a restricted <code>SecurityContextConstraints</code> (SCC) which does not allow use of custom security policies.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a project by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc new-project nginx-secure</code></pre>
</div>
</div>
</li>
<li>
<p>Create the following <code>RoleBinding</code> object to allow SELinux policies to be used in the <code>nginx-secure</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">spo-nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-secure</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">spo-deploy-test</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">spo-nginx</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Role</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="no">null</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">spo-nginx</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-secure</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">security.openshift.io</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">securitycontextconstraints</span>
  <span class="na">resourceNames</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">privileged</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">use</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>ServiceAccount</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="no">null</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">spo-deploy-test</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-secure</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Deployment</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">selinux-test</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">nginx-secure</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">selinux-test</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">selinux-test</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">selinux-test</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">spo-deploy-test</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">seLinuxOptions</span><span class="pi">:</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">nginx-secure_nginx-secure.process</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-unpriv</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">8080</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>.seLinuxOptions.type</code> must exist before the Deployment is created.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SELinux type is not specified in the workload and is handled by the SCC. When the pods are created by the deployment and the <code>ReplicaSet</code>, the pods will run with the appropriate profile.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ensure that your SCC is usable by only the correct service account. Refer to <em>Additional resources</em> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spo-recording-profiles_spo-selinux"><a class="anchor" href="#spo-recording-profiles_spo-selinux"></a>Recording profiles from workloads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Security Profiles Operator can record system calls with <code>ProfileRecording</code> objects, making it easier to create baseline profiles for applications.</p>
</div>
<div class="paragraph">
<p>When using the log enricher for recording SELinux profiles, verify the log enricher feature is enabled. See <em>Additional resources</em> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A container with <code>privileged: true</code> security context restraints prevents log-based recording. Privileged containers are not subject to SELinux policies, and log-based recording makes use of a special SELinux profile to record events.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a project by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc new-project my-namespace</code></pre>
</div>
</div>
</li>
<li>
<p>Label the namespace with <code>enable-recording=true</code> by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label ns my-namespace spo.x-k8s.io/enable-recording<span class="o">=</span><span class="nb">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>ProfileRecording</code> object containing a <code>recorder: logs</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security-profiles-operator.x-k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ProfileRecording</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">my-namespace</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">test-recording</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">SelinuxProfile</span>
  <span class="na">recorder</span><span class="pi">:</span> <span class="s">logs</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">my-app</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a workload to record:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">my-namespace</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-pod</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">my-app</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">securityContext</span><span class="pi">:</span>
    <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">seccompProfile</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">RuntimeDefault</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">capabilities</span><span class="pi">:</span>
          <span class="na">drop</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">ALL</span><span class="pi">]</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">redis</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/redis:6.2.1</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">capabilities</span><span class="pi">:</span>
          <span class="na">drop</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">ALL</span><span class="pi">]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Confirm the pod is in a <code>Running</code> state by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> my-namespace get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME     READY   STATUS    RESTARTS   AGE
my-pod   2/2     Running   0          18s</span></code></pre>
</div>
</div>
</li>
<li>
<p>Confirm the enricher indicates that it receives audit logs for those containers:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> openshift-security-profiles logs <span class="nt">--since</span><span class="o">=</span>1m <span class="nt">--selector</span> <span class="nv">name</span><span class="o">=</span>spod <span class="nt">-c</span> log-enricher</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">I0517 13:55:36.383187  348295 enricher.go:376] log-enricher "msg"="audit" "container"="redis" "namespace"="my-namespace" "node"="ip-10-0-189-53.us-east-2.compute.internal" "perm"="name_bind" "pod"="my-pod" "profile"="test-recording_redis_6kmrb_1684331729" "scontext"="system_u:system_r:selinuxrecording.process:s0:c4,c27" "tclass"="tcp_socket" "tcontext"="system_u:object_r:redis_port_t:s0" "timestamp"="1684331735.105:273965" "type"="selinux"</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Remove the pod:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> my-namepace delete pod my-pod</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm the Security Profiles Operator reconciles the two SELinux profiles:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get selinuxprofiles <span class="nt">-lspo</span>.x-k8s.io/recording-id<span class="o">=</span>test-recording <span class="nt">-n</span> my-namespace</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output for selinuxprofile</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                   USAGE                                       STATE
test-recording-nginx   test-recording-nginx_my-namespace.process   Installed
test-recording-redis   test-recording-redis_my-namespace.process   Installed</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="spo-container-profile-instances_spo-selinux"><a class="anchor" href="#spo-container-profile-instances_spo-selinux"></a>Merging per-container profile instances</h3>
<div class="paragraph">
<p>By default, each container instance records into a separate profile. The Security Profiles Operator can merge the per-container profiles into a single profile. Merging profiles is useful when deploying applications using <code>ReplicaSet</code> or <code>Deployment</code> objects.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit a <code>ProfileRecording</code> object to include a <code>mergeStrategy: containers</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security-profiles-operator.x-k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ProfileRecording</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="c1"># The name of the Recording is the same as the resulting SelinuxProfile CRD</span>
  <span class="c1"># after reconciliation.</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">test-recording</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">my-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">SelinuxProfile</span>
  <span class="na">recorder</span><span class="pi">:</span> <span class="s">logs</span>
  <span class="na">mergeStrategy</span><span class="pi">:</span> <span class="s">containers</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">sp-record</span></code></pre>
</div>
</div>
</li>
<li>
<p>Label the namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label ns my-namespace security.openshift.io/scc.podSecurityLabelSync<span class="o">=</span><span class="nb">false </span>pod-security.kubernetes.io/enforce<span class="o">=</span>privileged pod-security.kubernetes.io/audit<span class="o">=</span>privileged pod-security.kubernetes.io/warn<span class="o">=</span>privileged <span class="nt">--overwrite</span><span class="o">=</span><span class="nb">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create the workload with the following YAML:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-deploy</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">my-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">sp-record</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">sp-record</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">spo-record-sa</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-record</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/security-profiles-operator/test-nginx-unprivileged:1.21</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">8080</span></code></pre>
</div>
</div>
</li>
<li>
<p>To record the individual profiles, delete the deployment by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc delete deployment nginx-deploy <span class="nt">-n</span> my-namespace</code></pre>
</div>
</div>
</li>
<li>
<p>To merge the profiles, delete the profile recording by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc delete profilerecording test-recording <span class="nt">-n</span> my-namespace</code></pre>
</div>
</div>
</li>
<li>
<p>To start the merge operation and generate the results profile, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get selinuxprofiles <span class="nt">-lspo</span>.x-k8s.io/recording-id<span class="o">=</span>test-recording <span class="nt">-n</span> my-namespace</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output for selinuxprofiles</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                          USAGE                                              STATE
test-recording-nginx-record   test-recording-nginx-record_my-namespace.process   Installed</span></code></pre>
</div>
</div>
</li>
<li>
<p>To view the permissions used by any of the containers, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get selinuxprofiles test-recording-nginx-record <span class="nt">-o</span> yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="spo-selinux-runasany_spo-selinux"><a class="anchor" href="#spo-selinux-runasany_spo-selinux"></a>About seLinuxContext: RunAsAny</h3>
<div class="paragraph">
<p>Recording of SELinux policies is implemented with a webhook that injects a special SELinux type to the pods being recorded. The SELinux type makes the pod run in <code>permissive</code> mode, logging all the AVC denials into <code>audit.log</code>. By default, a workload is not allowed to run with a custom SELinux policy, but uses an auto-generated type.</p>
</div>
<div class="paragraph">
<p>To record a workload, the workload must use a service account that has permissions to use an SCC that allows the webhook to inject the permissive SELinux type. The <code>privileged</code> SCC contains <code>seLinuxContext: RunAsAny</code>.</p>
</div>
<div class="paragraph">
<p>In addition, the namespace must be labeled with <code>pod-security.kubernetes.io/enforce: privileged</code> if your cluster enables the <a href="https://kubernetes.io/docs/concepts/security/pod-security-admission/">Pod Security Admission</a> because only the <code>privileged</code> <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/#privileged">Pod Security Standard</a> allows using a custom SELinux policy.</p>
</div>
<h2 id="additional-resources_spo-selinux" class="discrete _additional-resources">Additional resources</h2>
<div class="ulist">
<ul>
<li>
<p><a href="../../authentication/managing-security-context-constraints.html">Managing security context constraints</a></p>
</li>
<li>
<p><a href="https://cloud.redhat.com/blog/managing-sccs-in-openshift">Managing SCCs in OpenShift</a></p>
</li>
<li>
<p><a href="../../security/security_profiles_operator/spo-advanced.html#spo-log-enricher_spo-advanced">Using the log enricher</a></p>
</li>
<li>
<p><a href="../../security/security_profiles_operator/spo-understanding.html#spo-about_spo-understanding">About security profiles</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.okd.io/latest/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'openshift-aro';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-telco': ['docs_telco', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version],
    'openshift-serverless' : ['docs_serverless', version],
    'openshift-pipelines' : ['docs_pipelines', version],
    'openshift-builds' : ['docs_builds', version],
    'openshift-gitops' : ['docs_gitops', version],
    'openshift-lightspeed' : ['docs_lightspeed', version],
    'openshift-service-mesh' : ['docs_service_mesh', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.net/content/img/Logo-Red_Hat-OpenShift-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright © 2025 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

  <!-- hide footer after 3 seconds -->
  <script type="text/javascript">
    const hideFooter = () => {
      document.querySelector('footer#rh, footer.footer-origin-docs').style.display = "none";
    };

    window.addEventListener('load', function() {
      setTimeout(hideFooter, 3000);
    });
  </script>
</body>
</html>